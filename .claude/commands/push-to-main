#!/bin/bash
# Push current branch to main after conflicts are resolved
# This is a helper command for the supervisor agent

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${YELLOW}Pushing to main branch...${NC}"

# First try normal push
if git push origin main; then
  echo -e "${GREEN}✓ Successfully pushed to origin/main${NC}"
  exit 0
fi

# If push failed, try pull --rebase
echo -e "${YELLOW}Push failed, attempting pull --rebase...${NC}"
if git pull --rebase origin main; then
  echo -e "${GREEN}✓ Rebased successfully${NC}"
  
  # Try push again
  if git push origin main; then
    echo -e "${GREEN}✓ Successfully pushed to origin/main after rebase${NC}"
    exit 0
  else
    echo -e "${RED}✗ Push failed even after rebase${NC}"
    exit 1
  fi
else
  echo -e "${RED}✗ Rebase failed - manual intervention required${NC}"
  echo "You may need to:"
  echo "  1. Resolve any rebase conflicts"
  echo "  2. Run: git rebase --continue"
  echo "  3. Then run this command again"
  exit 1
fi